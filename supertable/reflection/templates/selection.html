<div class="super-container" style="
    /* Using the main content background color from the sidebar CSS */
    background-color: #f3f6fb;
    font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    padding: 0px;
">
    <div class="card-professional-themed" style="
        background-color: #ffffff;
        border-radius: 16px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        padding: 24px 50px;
        border: 1px solid rgba(0, 0, 0, 0.05);
        border-left: 5px solid #1c96ca; /* Primary Accent Color */
    ">
        <div class="grid-professional" style="
            display: flex;
            gap: 40px;
            align-items: flex-start;
        ">
            <!-- LEFT: SuperTable selector -->
            <div style="flex-shrink: 0; min-width: 300px;">
                <label style="
                    display: block;
                    font-size: 14px;
                    color: #475569;
                    margin-bottom: 8px;
                    font-weight: 600;
                ">Select SuperTable</label>
                <select id="pairSel" onchange="onPairChange()" style="
                    width: 100%;
                    padding: 10px 12px;
                    border: 1px solid #d0d7e7;
                    border-radius: 8px;
                    font-size: 16px;
                    background-color: #ffffff;
                    cursor: pointer;
                    appearance: none;
                    background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20width%3D%2220%22%20height%3D%2220%22%20viewBox%3D%220%200%2020%2020%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Cpath%20d%3D%22M4%207L10%2013L16%207%22%20stroke%3D%22%23475569%22%20stroke-width%3D%222%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%2F%3E%0A%3C%2Fsvg%3E');
                    background-repeat: no-repeat;
                    background-position: right 10px center;
                ">
                </select>
                <div style="
                    font-size: 12px;
                    color: #8894a8;
                    margin-top: 10px;
                ">
                    Select a SuperTable to view its aggregated data metrics.
                </div>
            </div>

            <!-- RIGHT: Metric cards -->
            <div style="flex-grow: 1;">
                <div class="summary-grid" style="
                    display: grid;
                    grid-template-columns: repeat(4, 1fr);
                    gap: 15px;
                ">

                    <!-- FILES -->
                    <div class="metric-card-themed" style="
                        background-color: #f5faff;
                        border: 1px solid #e2e8f0;
                        border-radius: 8px;
                        padding: 15px;
                        display: flex;
                        align-items: center;
                        gap: 12px;
                    ">
                        <div class="metric-icon" style="
                            color: #1c96ca;
                            font-size: 20px;
                        "><i class="fas fa-file"></i></div>
                        <div class="metric-content">
                            <div class="metric-label" style="
                                font-size: 12px;
                                color: #475569;
                                font-weight: 500;
                            ">FILES</div>
                            <div class="metric-value" id="tenantFilesValue" style="
                                font-size: 20px;
                                font-weight: 700;
                                color: #34475e;
                            ">n/a</div>
                        </div>
                    </div>

                    <!-- ROWS -->
                    <div class="metric-card-themed" style="
                        background-color: #ffffff;
                        border: 1px solid #d0d7e7;
                        border-radius: 8px;
                        padding: 15px;
                        display: flex;
                        align-items: center;
                        gap: 12px;
                    ">
                        <div class="metric-icon" style="
                            color: #475569;
                            font-size: 20px;
                        "><i class="fas fa-bars"></i></div>
                        <div class="metric-content">
                            <div class="metric-label" style="
                                font-size: 12px;
                                color: #475569;
                                font-weight: 500;
                            ">ROWS</div>
                            <div class="metric-value" id="tenantRowsValue" style="
                                font-size: 20px;
                                font-weight: 700;
                                color: #34475e;
                            ">n/a</div>
                        </div>
                    </div>

                    <!-- VERSION -->
                    <div class="metric-card-themed" style="
                        background-color: #f5faff;
                        border: 1px solid #e2e8f0;
                        border-radius: 8px;
                        padding: 15px;
                        display: flex;
                        align-items: center;
                        gap: 12px;
                    ">
                        <div class="metric-icon" style="
                            color: #1c96ca;
                            font-size: 20px;
                        "><i class="fas fa-code-branch"></i></div>
                        <div class="metric-content">
                            <div class="metric-label" style="
                                font-size: 12px;
                                color: #475569;
                                font-weight: 500;
                            ">VERSION</div>
                            <div class="metric-value" id="tenantVersionValue" style="
                                font-size: 20px;
                                font-weight: 700;
                                color: #34475e;
                            ">n/a</div>
                        </div>
                    </div>

                    <!-- BYTE SIZE -->
                    <div class="metric-card-themed" style="
                        background-color: #f5faff;
                        border: 1px solid #e2e8f0;
                        border-radius: 8px;
                        padding: 15px;
                        display: flex;
                        align-items: center;
                        gap: 12px;
                    ">
                        <div class="metric-icon" style="
                            color: #1c96ca;
                            font-size: 20px;
                        "><i class="fas fa-database"></i></div>
                        <div class="metric-content">
                            <div class="metric-label" style="
                                font-size: 12px;
                                color: #475569;
                                font-weight: 500;
                            ">BYTE SIZE</div>
                            <div class="metric-value" id="tenantSizeValue" style="
                                font-size: 20px;
                                font-weight: 700;
                                color: #34475e;
                            ">n/a</div>
                        </div>
                    </div>
                </div>

                <div class="tenant-updated" style="
                    margin-top: 15px;
                    text-align: right;
                    font-size: 13px;
                    color: #475569;
                ">
                    Last updated:
                    <span id="tenantUpdatedValue" style="
                        font-weight: 600;
                        color: #34475e;
                    ">n/a</span>
                </div>
            </div>

        </div>
    </div>
</div>

<!-- Selection logic: calls /meta/supers and /meta/super -->
<script>
(function () {
    // TODO: if you want these dynamic, inject them server-side.
    const ORG_NAME = "kladna-soft";
    const USER_HASH = "0b85b786b16d195439c0da18fd4478df";

    const pairSel = document.getElementById("pairSel");
    const filesEl = document.getElementById("tenantFilesValue");
    const rowsEl = document.getElementById("tenantRowsValue");
    const sizeEl = document.getElementById("tenantSizeValue");
    const versionEl = document.getElementById("tenantVersionValue");
    const updatedEl = document.getElementById("tenantUpdatedValue");

    function formatBytes(bytes) {
        if (bytes === null || bytes === undefined || isNaN(bytes)) {
            return "n/a";
        }
        let val = Number(bytes);
        const units = ["B", "KB", "MB", "GB", "TB", "PB"];
        let i = 0;
        while (val >= 1024 && i < units.length - 1) {
            val /= 1024;
            i++;
        }
        return val.toFixed(1) + " " + units[i];
    }

    function formatDate(ms) {
        if (!ms && ms !== 0) return "n/a";
        const d = new Date(ms);
        if (isNaN(d.getTime())) return "n/a";
        return d.toLocaleString();
    }

    function applySuperMeta(superMeta) {
        if (!superMeta) {
            filesEl.textContent = "n/a";
            rowsEl.textContent = "n/a";
            sizeEl.textContent = "n/a";
            versionEl.textContent = "n/a";
            updatedEl.textContent = "n/a";
            return;
        }

        filesEl.textContent = superMeta.files != null ? superMeta.files : "0";
        rowsEl.textContent = superMeta.rows != null ? superMeta.rows : "0";
        sizeEl.textContent = superMeta.size != null ? formatBytes(superMeta.size) : "n/a";
        versionEl.textContent = superMeta.version != null ? superMeta.version : "n/a";
        updatedEl.textContent = formatDate(superMeta.updated_utc);
    }

    async function loadSupers() {
        try {
            const resp = await fetch(
                "/meta/supers?organization=" + encodeURIComponent(ORG_NAME)
            );
            if (!resp.ok) {
                throw new Error("Failed to load supers: " + resp.status);
            }
            const data = await resp.json();
            const supers = (data && data.supers) || [];

            pairSel.innerHTML = "";

            if (!supers.length) {
                const opt = document.createElement("option");
                opt.value = "";
                opt.textContent = "No SuperTables found";
                pairSel.appendChild(opt);
                applySuperMeta(null);
                return;
            }

            supers.forEach(function (name) {
                const opt = document.createElement("option");
                opt.value = name;
                opt.textContent = name;
                pairSel.appendChild(opt);
            });

            // Auto-load first SuperTable
            if (pairSel.value) {
                await loadSuperMeta(pairSel.value);
            } else {
                applySuperMeta(null);
            }
        } catch (err) {
            console.error("Error loading supers:", err);
            applySuperMeta(null);
        }
    }

    async function loadSuperMeta(superName) {
        if (!superName) {
            applySuperMeta(null);
            return;
        }

        try {
            const params = new URLSearchParams({
                organization: ORG_NAME,
                super_name: superName,
                user_hash: USER_HASH
            });

            const resp = await fetch("/meta/super?" + params.toString());
            if (!resp.ok) {
                throw new Error("Failed to load super meta: " + resp.status);
            }
            const data = await resp.json();
            const superMeta = data && data.meta && data.meta.super;
            applySuperMeta(superMeta || null);
        } catch (err) {
            console.error("Error loading super meta:", err);
            applySuperMeta(null);
        }
    }

    // Expose for onchange="onPairChange()"
    window.onPairChange = function onPairChange() {
        const superName = pairSel.value;
        loadSuperMeta(superName);
    };

    if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", loadSupers);
    } else {
        loadSupers();
    }
})();
</script>
