<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>SuperTable Admin – Config</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Inter; background:#0b1220; color:#e2e8f0; margin:0; }
    .wrap { max-width: 1000px; margin: 0 auto; padding: 24px; }
    .card { background:#0f172a; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.3); }
    .section { padding: 16px 20px; }
    table { width:100%; border-collapse: collapse; }
    th, td { text-align:left; border-bottom:1px solid #22314a; vertical-align: top; }
    .px-3 { padding-left:12px; padding-right:12px; }
    .py-2 { padding-top:8px; padding-bottom:8px; }
    .muted { color:#94a3b8; }
    .btn { padding: 8px 12px; border-radius: 10px; background:#0b2940; border:1px solid #1d3b57; color:#e2e8f0; font-weight:500; cursor:pointer; }
    a { color:#38bdf8; text-decoration:none; }
    code { background:#0b2940; padding:2px 6px; border-radius:6px; border:1px solid #1d3b57; }
    .ok { color:#22c55e; }
    .warn { color:#f59e0b; }
    .err { color:#ef4444; }
  </style>
  <script>
    let revealed = false;
    function toggleReveal() {
      revealed = !revealed;
      document.querySelectorAll('.masked').forEach(el => {
        const full = el.getAttribute('data-full') || '';
        const key = (el.getAttribute('data-key') || '').toLowerCase();
        const sens = key.includes('pass') || key.includes('token') || key.includes('secret') || key.includes('key');
        if (!full) { el.textContent = ''; return; }
        if (!revealed) {
          if (!sens) { el.textContent = full; return; }
          if (full.length <= 6) { el.textContent = '•••'; return; }
          el.textContent = full.slice(0,2) + '•••' + full.slice(-2);
        } else {
          el.textContent = full;
        }
      });
      document.getElementById('revealbtn').textContent = revealed ? 'Hide values' : 'Show values';
    }
  </script>
</head>
<body>
  <div class="wrap">
    <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:12px;">
      <h2 style="margin:0;">Config</h2>
      <div class="muted"><a href="/admin">Back</a></div>
    </div>

    <div class="card">
      <div class="section">
        <div class="muted">
          {% if dotenv_found %}
            Loaded .env from <code>{{ dotenv_path }}</code> <span class="ok">✓</span>
          {% else %}
            <span class="warn">No .env found</span> — tried:
            <ul style="margin:6px 0 0 18px;">
              {% for p, ex in tried %}
                <li><code>{{ p }}</code> — {% if ex %}<span class="ok">exists</span>{% else %}<span class="err">missing</span>{% endif %}</li>
              {% endfor %}
            </ul>
            <div style="margin-top:8px;">Set a custom path with:
              <code>export DOTENV_PATH=/absolute/path/to/.env</code>
            </div>
          {% endif %}
        </div>

        <div style="margin-top:12px;"><button id="revealbtn" class="btn" onclick="toggleReveal()">Show values</button></div>

        <div style="margin-top:12px;">
          <table>
            <thead>
              <tr>
                <th class="px-3 py-2 muted">Key</th>
                <th class="px-3 py-2 muted">.env value</th>
                <th class="px-3 py-2 muted">Effective env</th>
              </tr>
            </thead>
            <tbody>
              {% for row in rows %}
                <tr>
                  <td class="px-3 py-2 font-mono text-sm">{{ row.key }}</td>
                  <td class="px-3 py-2 text-sm">
                    <span class="masked" data-key="{{ row.key|lower }}" data-full="{{ row.env_val or '' }}">
                      {% if row.is_sensitive %}
                        {{ (row.env_val or '')[:2] ~ '•••' ~ (row.env_val or '')[-2:] if row.env_val and (row.env_val|length) > 6 else '•••' if row.env_val else '' }}
                      {% else %}{{ row.env_val or '' }}{% endif %}
                    </span>
                  </td>
                  <td class="px-3 py-2 text-sm">
                    <span class="masked" data-key="{{ row.key|lower }}" data-full="{{ row.eff_val or '' }}">
                      {% if row.is_sensitive %}
                        {{ (row.eff_val or '')[:2] ~ '•••' ~ (row.eff_val or '')[-2:] if row.eff_val and (row.eff_val|length) > 6 else '•••' if row.eff_val else '' }}
                      {% else %}{{ row.eff_val or '' }}{% endif %}
                    </span>
                  </td>
                </tr>
              {% endfor %}
              {% if rows|length == 0 %}
                <tr><td class="px-3 py-2" colspan="3"><span class="muted">No variables to display.</span></td></tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

  </div>
</body>
</html>
